<mxfile host="app.diagrams.net">
  <diagram name="用户操作核心流程" id="user-flow-core">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- 开始 -->
        <mxCell id="start" value="进入页面" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;fillColor=#C8E6C9;strokeColor=#388E3C;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="340" y="40" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 加载数据 -->
        <mxCell id="load" value="加载试卷数据&lt;br&gt;&lt;font style=&quot;font-size: 11px;&quot; color=&quot;#666666&quot;&gt;getMakePaper()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#BBDEFB;strokeColor=#1976D2;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="340" y="140" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 判断模式 -->
        <mxCell id="check-mode" value="有图片文件?" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fillColor=#FFF9C4;strokeColor=#F9A825;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="340" y="240" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <!-- HTML模式 -->
        <mxCell id="html-mode" value="HTML模式&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#666666&quot;&gt;QuestionMatch&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1F5FE;strokeColor=#0288D1;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="140" y="260" width="120" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 图片模式 -->
        <mxCell id="img-mode" value="图片模式&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#666666&quot;&gt;ImageQuestionMatch&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="560" y="260" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 点击题目 -->
        <mxCell id="click" value="点击题目节点&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#666666&quot;&gt;（题干/答案/解析）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="560" y="380" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 判断内容 -->
        <mxCell id="has-content" value="已有划分?" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fillColor=#FFF9C4;strokeColor=#F9A825;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="560" y="480" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <!-- 高亮 -->
        <mxCell id="highlight" value="高亮对应分区&lt;br&gt;&amp;amp; 滚动到视图" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C8E6C9;strokeColor=#388E3C;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="760" y="500" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 绘制模式 -->
        <mxCell id="draw-mode" value="进入绘制模式&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#666666&quot;&gt;setIsDrawingMode(true)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="560" y="620" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 绘制矩形 -->
        <mxCell id="draw" value="🖱️ 拖拽绘制矩形&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#666666&quot;&gt;mouseDown → mouseMove → mouseUp&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCCBC;strokeColor=#FF5722;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="560" y="720" width="140" height="70" as="geometry"/>
        </mxCell>
        
        <!-- 坐标转换 -->
        <mxCell id="convert" value="计算坐标&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#666666&quot;&gt;显示坐标 → 原始坐标&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B39DDB;strokeColor=#512DA8;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="560" y="830" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 更新数据 -->
        <mxCell id="update-data" value="更新数据结构&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#666666&quot;&gt;content + delta + biz_extra&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCDD2;strokeColor=#E53935;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="560" y="930" width="140" height="70" as="geometry"/>
        </mxCell>
        
        <!-- 保存 -->
        <mxCell id="save" value="💾 自动保存&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#666666&quot;&gt;防抖1秒&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8BBD0;strokeColor=#C2185B;fontSize=13;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="560" y="1040" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 重绘UI -->
        <mxCell id="redraw" value="重绘Canvas" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#B2DFDB;strokeColor=#00897B;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="560" y="1140" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- 更多操作 -->
        <mxCell id="more" value="更多操作?" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.decision;whiteSpace=wrap;fillColor=#FFF9C4;strokeColor=#F9A825;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="560" y="1240" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <!-- 操作分支 -->
        <mxCell id="continue-draw" value="继续划分" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1F5FE;strokeColor=#0288D1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="340" y="1260" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="redivide" value="重新划分" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF9C4;strokeColor=#F9A825;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="340" y="1320" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="resize" value="调整大小" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1BEE7;strokeColor=#7B1FA2;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="760" y="1260" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <mxCell id="delete" value="删除划分" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFCCBC;strokeColor=#FF5722;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="760" y="1320" width="100" height="40" as="geometry"/>
        </mxCell>
        
        <!-- 结束 -->
        <mxCell id="end" value="完成" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;fillColor=#C8E6C9;strokeColor=#388E3C;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="560" y="1400" width="140" height="60" as="geometry"/>
        </mxCell>
        
        <!-- ========== 连线 ========== -->
        
        <!-- 主流程连线 -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#1976D2;" edge="1" parent="1" source="start" target="load">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#1976D2;" edge="1" parent="1" source="load" target="check-mode">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- 模式分支 -->
        <mxCell id="arrow3" value="无" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;entryX=1;entryY=0.5;strokeWidth=2;strokeColor=#0288D1;" edge="1" parent="1" source="check-mode" target="html-mode">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow4" value="有" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;strokeWidth=2;strokeColor=#F57C00;fontStyle=1" edge="1" parent="1" source="check-mode" target="img-mode">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <!-- 图片模式流程 -->
        <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#F57C00;" edge="1" parent="1" source="img-mode" target="click">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#7B1FA2;" edge="1" parent="1" source="click" target="has-content">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- 判断分支 -->
        <mxCell id="arrow7" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;strokeWidth=2;strokeColor=#388E3C;" edge="1" parent="1" source="has-content" target="highlight">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="10" y="-10" as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow8" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#F57C00;fontStyle=1" edge="1" parent="1" source="has-content" target="draw-mode">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-20" y="0" as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <!-- 绘制流程 -->
        <mxCell id="arrow9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#FF5722;" edge="1" parent="1" source="draw-mode" target="draw">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#512DA8;" edge="1" parent="1" source="draw" target="convert">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#E53935;" edge="1" parent="1" source="convert" target="update-data">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#C2185B;dashed=1;" edge="1" parent="1" source="update-data" target="save">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#00897B;" edge="1" parent="1" source="save" target="redraw">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#1976D2;" edge="1" parent="1" source="redraw" target="more">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- 更多操作分支 -->
        <mxCell id="arrow15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;entryX=1;entryY=0.5;strokeWidth=1.5;strokeColor=#0288D1;" edge="1" parent="1" source="more" target="continue-draw">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;entryX=1;entryY=0.5;strokeWidth=1.5;strokeColor=#F9A825;" edge="1" parent="1" source="more" target="redivide">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;entryX=0;entryY=0.5;strokeWidth=1.5;strokeColor=#7B1FA2;" edge="1" parent="1" source="more" target="resize">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="arrow18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;entryX=0;entryY=0.5;strokeWidth=1.5;strokeColor=#FF5722;" edge="1" parent="1" source="more" target="delete">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- 循环回绘制 -->
        <mxCell id="arrow19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;entryX=0;entryY=0.5;strokeWidth=2;strokeColor=#0288D1;curved=1;dashed=1;" edge="1" parent="1" source="continue-draw" target="draw">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="300" y="1280"/>
              <mxPoint x="300" y="755"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow20" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;entryX=0;entryY=0.5;strokeWidth=2;strokeColor=#F9A825;curved=1;dashed=1;" edge="1" parent="1" source="redivide" target="draw">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="280" y="1340"/>
              <mxPoint x="280" y="755"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;entryX=1;entryY=0.5;strokeWidth=2;strokeColor=#7B1FA2;curved=1;dashed=1;" edge="1" parent="1" source="resize" target="convert">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="920" y="1280"/>
              <mxPoint x="920" y="860"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;entryX=1;entryY=0.5;strokeWidth=2;strokeColor=#FF5722;curved=1;dashed=1;" edge="1" parent="1" source="delete" target="update-data">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="940" y="1340"/>
              <mxPoint x="940" y="965"/>
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- 完成 -->
        <mxCell id="arrow23" value="完成" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;strokeWidth=2;strokeColor=#388E3C;fontStyle=1" edge="1" parent="1" source="more" target="end">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-20" y="0" as="offset"/>
          </mxGeometry>
        </mxCell>
        
        <!-- 注释框 -->
        <mxCell id="note1" value="💡 关键点&lt;br&gt;&lt;br&gt;• 坐标转换：显示坐标按缩放比例转换为原始坐标&lt;br&gt;• 防抖保存：避免频繁请求后端&lt;br&gt;• 虚拟节点：一题多空场景特殊处理" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#FFF3E0;size=20;align=left;verticalAlign=top;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="40" y="720" width="220" height="120" as="geometry"/>
        </mxCell>
        
        <mxCell id="note2" value="🎯 操作类型&lt;br&gt;&lt;br&gt;• 继续划分：添加新的分区&lt;br&gt;• 重新划分：替换已有分区&lt;br&gt;• 调整大小：拖拽8个控制点&lt;br&gt;• 删除划分：清除分区数据" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#E8F5E9;size=20;align=left;verticalAlign=top;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="40" y="1160" width="220" height="120" as="geometry"/>
        </mxCell>
        
        <!-- 图例 -->
        <mxCell id="legend-box" value="图例" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FAFAFA;fontSize=12;fontStyle=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="220" height="160" as="geometry"/>
        </mxCell>
        
        <mxCell id="leg1" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#1976D2;" edge="1" parent="legend-box">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="20" y="50" as="sourcePoint"/>
            <mxPoint x="70" y="50" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="leg1-text" value="实线 - 主流程" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=11;" vertex="1" parent="legend-box">
          <mxGeometry x="80" y="40" width="120" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="leg2" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#7B1FA2;dashed=1;" edge="1" parent="legend-box">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="20" y="80" as="sourcePoint"/>
            <mxPoint x="70" y="80" as="targetPoint"/>
          </mxGeometry>
        </mxCell>
        <mxCell id="leg2-text" value="虚线 - 循环/异步" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=11;" vertex="1" parent="legend-box">
          <mxGeometry x="80" y="70" width="120" height="20" as="geometry"/>
        </mxCell>
        
        <mxCell id="leg3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE0B2;strokeColor=#F57C00;" vertex="1" parent="legend-box">
          <mxGeometry x="20" y="110" width="50" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="leg3-text" value="橙色 - 核心操作" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;fontSize=11;" vertex="1" parent="legend-box">
          <mxGeometry x="80" y="115" width="120" height="20" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
